define("base/promise",[],function(){function t(e){this.state=t.STATE_UNFULFILLED,this.resolveCallbacks=[],this.rejecteCallbacks=[],e&&setTimeout(function(){e(r(this.resolve,this),r(this.reject,this))},0)}var e=Array.prototype.slice,s=Array.prototype.indexOf||function(t){for(var e=0,s=this.length;s>e;e++)if(t===this[e])return e;return-1},r=function(t,e){return t.bind?t.bind(e):function(){return t.apply(e,arguments)}};return t.STATE_UNFULFILLED=0,t.STATE_RESOLVED=1,t.STATE_REJECTED=2,t.prototype={constructor:t,when:function(){var r=new t,n=e.call(arguments),i=[],a=this,l=function(e){if(a.state===t.STATE_UNFULFILLED){var l=s.call(n,this);l>-1&&(n.splice(l,1),i[l]=e),n.length||(r.resolve(i),a.state=t.STATE_RESOLVED)}},o=function(){if(a.state===t.STATE_UNFULFILLED){var e=s.call(n,this);e>-1&&n.splice(e,1),n.length||(r.reject(),a.state=t.STATE_REJECTED)}};if(n.length)for(var c=0,h=n.length;h>c;c++){if(!(n[c]instanceof t))throw"when() Parameter must be a type of Promise";n[c].then(l,o)}else setTimeout(function(){a.resolve()},0);return r},then:function(s,n){var i=new t,a=this;return s&&this.resolveCallbacks.push(function(){var t=[r(i.resolve,i),r(i.reject,i)].concat(e.call(arguments));s.apply(a,t)}),n&&this.rejecteCallbacks.push(function(){{var t=[r(i.reject,i)].concat(e.call(arguments));n.apply(a,t)}}),i},resolve:function(){var e=arguments;setTimeout($.proxy(function(){if(this.state===t.STATE_UNFULFILLED){for(var s=0,r=this.resolveCallbacks.length;r>s;s++)this.resolveCallbacks[s].apply(this,e);this.state=t.STATE_RESOLVED}},this),0)},reject:function(){var e=arguments;setTimeout($.proxy(function(){if(this.state===t.STATE_UNFULFILLED){for(var s=0,r=this.rejecteCallbacks.length;r>s;s++)this.rejecteCallbacks[s].apply(this,e);this.state=t.STATE_REJECTED}},this),0)}},t});