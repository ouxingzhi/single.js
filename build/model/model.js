define("model/model.js",["base/base","base/event","common/funs","storage/store"],function(require,t,e){function i(){}var s=require("base/base"),r=require("base/event"),a=require("common/funs"),h=require("storage/store"),n=0,o=1,u=2,l=function(){this.off("success"),this.off("error"),this.off("abort")},c=/\{[^\{\}]*\}/,f=r.extend({propertys:function(){this._xhr,this.type="post",this.getfields=[],this.pathfields=[],this.param=this.buildParam(),this.result=this.buildResult(),this.state=n},initialize:function(){},setType:function(t){this.type=t},fieldsGet:function(){return[]},buildBaseUrl:function(){throw"Please override the `buildBaseUrl` method"},buildUrl:function(){throw"Please override the `buildUrl` method"},buildParam:function(){throw"Please override the `buildParam` method"},buildResult:function(){throw"Please override the `buildResult` method"},ajaxRequest:function(){throw"Please override the `ajaxRequest(type,url)` method"},verifyData:function(t){return!0},getParam:function(t){return this.param instanceof h?t?this.param.getAttr(t):this.param.get():this.param},setParam:function(t,e){return"object"===s.type(t)?void s.each(t,function(t,e){this.setParam(e,t)},this):void(this.param instanceof h?this.param.setAttr(t,e):(this.param||(this.param={}),this.param[t]=e))},delParam:function(t){return"array"===s.type(t)?void s.each(t,function(t){this.delParam(t)},this):void(this.param instanceof h?this.param.delAttr(t):(this.param||(this.param={}),delete this.param[k]))},getResult:function(){if(this.result instanceof h){var t=this.getParam(),e=t?JSON.stringify(t):null;return this.result.get(e)}return this.result},setResult:function(t){if(this.result instanceof h){var e=this.getParam(),i=e?JSON.stringify(e):null;this.result.set(t,i)}else this.result=t},request:function(t,e){t=t||{};var r,h=t.success||i,f=t.error||i,m=t.abort||i;if(this.state===u){if(r=this.getResult())return void h.call(e||this,r);this.state=n}if(this.state==u||(this.on("success",h,e),this.on("error",f,e),this.on("abort",m,e),this.state!==o)){this.baseurl=this.buildBaseUrl(),this.url=this.buildUrl();var d=this.baseurl.replace(/\/+$/g,"")+"/"+this.url.replace(/^\/+/g,""),p=this.getParam(),b=this;if(this.type&&!this.type.match(/get/i)){var v=d.indexOf("?")>-1?"&":"?",g=function(t,e){var i=[];return"*"===t?s.each(e,function(t,e){i.push(e+"="+t)}):s.each(t,function(t){e[t]&&i.push(t+"="+e[t])}),i.join("&")}(this.fieldsGet(),p);g&&(d=(d+v+g).replace(/\?{2,}/i,"?").replace(/\?&+/i,"?"))}var P=[];return d.match(c)&&(d=a.formatString(d,p||{},function(t){P.push(t)}),s.each(P,function(t){delete p[t]})),this.isAbort=!1,this.state=o,this._xhr=this.ajaxRequest(this.type,d,p,function(t){b.verifyData(t)?(b.setResult(t),b.emit("success",t),b.state=u):(b.emit("error",t),b.state=n),l.call(b),this.isAbort=!1},function(t){this.isAbort?b.emit("abort",t):b.emit("error",t),b.state=n,l.call(b),this.isAbort=!1}),this._xhr}},abort:function(){this._xhr&&(this.isAbort=!0,this._xhr.abort())}});return f});