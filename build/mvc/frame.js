define("SINGLE/mvc/frame.js",["base/base","base/event","base/hash","base/promise","common/funs","common/url.hash","mvc/header","mvc/transition.default","mvc/transition.updown","mvc/transition.notanime","mvc/errorview","ui/dialog","ui/toast","ui/loading"],function(require,i,t){var e=require("base/base"),a=require("base/event"),s=require("base/hash"),o=require("base/promise"),n=require("common/funs"),r=require("common/url.hash"),h=require("mvc/header"),w=require("mvc/transition.default"),d=require("mvc/transition.updown"),f=require("mvc/transition.notanime");MvcErrorView=require("mvc/errorview");var u=require("ui/dialog"),c=require("ui/toast"),l=require("ui/loading"),v="single-frame-box",m="single-frame-head",V="single-frame-viewport",p="single-frame-foot",g=['<div class="'+v+'">','<div class="'+m+'"></div>','<div class="'+V+'">',"</div>",'<div class="'+p+'"></div>',"</div>"].join(""),b=n.createSingle(c),L=n.createSingle(u),E=n.createSingle(l),x=a.extend({propertys:function(){this.app,this.root=$(g),this.viewhead=this.root.find("."+m),this.viewport=this.root.find("."+V),this.viewfoot=this.root.find("."+p),this.header=new h({box:this.viewhead,frame:this}),this.name,this.views=new s,this.hashdata={},this.viewpath="./src/views",this.framebox,this.defaultView="index",this.transtions={"default":w,updown:d,notanimte:f},this.defaultTranstion="default",this.defaultErrorView,this.lastView,this.curView},initialize:function($super,i){$super(),this.setOption(i),this.initDom(),this.app.config.hideHeader&&this.header.hide()},setOption:function(i){e.isNUL(i.app)||(this.app=i.app),e.isNUL(i.name)||(this.name=i.name),e.isNUL(i.viewpath)||(this.viewpath=i.viewpath),e.isNUL(i.framebox)||(this.framebox=i.framebox),e.isNUL(i.defaultView)||(this.defaultView=i.defaultView),e.isNUL(i.transtions)||e.mix(this.transtions,i.transtions),e.isNUL(i.config.defaultTranstion)||(this.defaultTranstion=i.config.defaultTranstion),e.isNUL(i.config.defaultErrorView)||(this.defaultErrorView=i.config.defaultErrorView)},getRoot:function(){return this.root},initDom:function(){this.framebox.append(this.root)},hashChange:function(i){if(!i.view){var t=new r(this.defaultView);for(var a in t)e.isEmpty(i[a])||(t[a]=i[a]);i=t}this.hashdata=i,this.header.setForward(this.hashdata.forward),this.toView(i.view,i)},toView:function(i,t){var e=this;this.getView(i,t).then(function(i,t,a){e.lastView=e.curView||a,e.curView=a,a.emit("onLoadBefore",e.lastView.hashdata.view),a.onLoad(e.lastView.hashdata.view),a.emit("onLoadAfter",e.lastView.hashdata.view)})},turning:function(i){var t=this.lastView||this.curView;this.curView===this.lastView?(this.curView.getRoot().show(),this.curView.emit("onShowBefore",t.hashdata.view),this.curView.onShow(t.hashdata.view),this.curView.emit("onShowAfter",t.hashdata.view)):this.transferView(i,this.lastView,this.curView,function(){this.lastView.emit("onHideBefore"),this.lastView.onHide(),this.lastView.emit("onHideAfter"),this.curView.emit("onShowBefore",t.hashdata.view),this.curView.onShow(t.hashdata.view),this.curView.emit("onShowAfter",t.hashdata.view)})},getView:function(i,t){var e=this.views.get(i),a=new o,s=this;return e?(e.setHashData(t),a.resolve(e)):this.loadView(i,function(e){if(e){var o=new e(i,t,this,this.app);this.viewport.append(o.getRoot()),o.emit("addframe"),this.views.push(i,o),a.resolve(o)}else{var n=this.views.get("<errorview>");n?(n.setHashData(t),a.resolve(n)):s.getErrorView(function(e){if(!e)throw new Error("not found `"+i+".js`");var s=new e("<errorview>",t,this,this.app);this.viewport.append(s.getRoot()),s.emit("addframe"),this.views.push("<errorview>",s),a.resolve(s)})}}),a},getErrorView:function(i){var t=this.defaultErrorView;t?this.loadView(t,function(t){i.call(this,t)}):i.call(this,MvcErrorView)},loadView:function(i,t){var e=this.buildFullPath(i),a=this;seajs.use([e],function(i){t.call(a,i)})},getCurrentView:function(){return this.curView||this.lastView},buildFullPath:function(i){return(this.viewpath+"/"+i).replace(/\/+/g,"/")+".js"},transferView:function(i,t,e,a){var s=this.getTransferFn(i);s(t.getRoot(),e.getRoot(),function(){a.call(this)},this)},getTransferFn:function(i){var t;switch(i=i||this.defaultTranstion){case"left":t=w.into;break;case"right":t=w.out;break;case"top":t=d.into;break;case"bottom":t=d.out;break;default:var e=this.transtions[i]||w;t=this.hashdata.forward?e.into:e.out}return t},forward:function(i){var t=r.parse(i);t.frame&&t.frame!==this.name||this.hashChange(t)},back:function(){history.back()},toHead:function(i,t){this.header.to(i,t)},showToast:function(i,t,e){b().show({content:i,timeout:t,callback:e})},hideToast:function(){b().hide()},showAlert:function(i,t,e,a){L().show({title:e||"标题",content:i||"",buttons:t,hideTitle:!a})},hideAlert:function(){L().hide()},showLoading:function(i){E().show({maskOpacity:i})},hideLoading:function(){E().hide()},showHeader:function(){this.header.show()},hideHeader:function(){this.header.hide()}});return x});