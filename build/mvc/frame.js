define("mvc/frame",["base/base","base/event","base/hash","base/promise","common/url.hash","mvc/transition.default"],function(require,t,i){var e=require("base/base"),s=require("base/event"),a=require("base/hash"),n=require("base/promise"),h=require("common/url.hash"),o=require("mvc/transition.default"),r="fly-frame-viewport",u='<div class="'+r+'"></div>',w=s.extend({propertys:function(){this.app,this.root=$(u),this.viewport=this.root,this.name,this.views=new a,this.hashdata={},this.viewpath="./src/views",this.framebox,this.defaultView="index",this.transtion=o,this.lastView,this.curView},initialize:function($super,t){$super(),this.setOption(t),this.initDom()},setOption:function(t){e.isNUL(t.app)||(this.app=t.app),e.isNUL(t.name)||(this.name=t.name),e.isNUL(t.viewpath)||(this.viewpath=t.viewpath),e.isNUL(t.framebox)||(this.framebox=t.framebox),e.isNUL(t.defaultView)||(this.defaultView=t.defaultView),e.isNUL(t.transtion)||(this.transtion=t.transtion)},getRoot:function(){return this.root},initDom:function(){this.framebox.append(this.root)},hashChange:function(t){t.view||(t=h.parse(this.defaultView)),this.hashdata=t,this.toView(t.view,t)},toView:function(t,i){var e=this;this.getView(t,i).then(function(t,i,s){e.lastView=e.curView||s,e.curView=s,s.onLoad()})},turning:function(){this.curView===this.lastView?(this.curView.getRoot().show(),this.curView.onShow()):this.transferView(this.lastView,this.curView,function(){this.lastView.onHide(),this.curView.onShow()})},getView:function(t,i){var e=this.views.get(t),s=new n;return e?(e.setHashData(i),s.resolve(e)):this.loadView(t,function(e){var a=new e(t,i,this,this.app);this.viewport.append(a.getRoot()),a.emit("addframe"),this.views.push(t,a),a.onCreate(),s.resolve(a)}),s},loadView:function(t,i){var e=this.buildFullPath(t),s=this;seajs.use([e],function(t){i.call(s,t)})},buildFullPath:function(t){return(this.viewpath+"/"+t).replace(/\/+/g,"/")+".js"},transferView:function(t,i,e){this.hashdata.forward?this.transtion.into(t.getRoot(),i.getRoot(),function(){e.call(this)},this):this.transtion.out(t.getRoot(),i.getRoot(),function(){e.call(this)},this)},forward:function(t){var i=h.parse(t);i.frame&&i.frame!==this.name||this.hashChange(i)},back:function(){}});return w});