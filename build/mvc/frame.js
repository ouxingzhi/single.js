define("mvc/frame.js",["base/base","base/event","base/hash","base/promise","common/funs","common/url.hash","mvc/header","mvc/transition.default","ui/dialog","ui/toast","ui/loading"],function(require,i,t){var e=require("base/base"),s=require("base/event"),a=require("base/hash"),n=require("base/promise"),o=require("common/funs"),h=require("common/url.hash"),r=require("mvc/header"),u=require("mvc/transition.default"),c=require("ui/dialog"),d=require("ui/toast"),f=require("ui/loading"),w="single-frame-box",l="single-frame-head",v="single-frame-viewport",m="single-frame-foot",p=['<div class="'+w+'">','<div class="'+l+'"></div>','<div class="'+v+'">',"</div>",'<div class="'+m+'"></div>',"</div>"].join(""),V=o.createSingle(d),g=o.createSingle(c),b=o.createSingle(f),x=s.extend({propertys:function(){this.app,this.root=$(p),this.viewhead=this.root.find("."+l),this.viewport=this.root.find("."+v),this.viewfoot=this.root.find("."+m),this.header=new r({box:this.viewhead,frame:this}),this.name,this.views=new a,this.hashdata={},this.viewpath="./src/views",this.framebox,this.defaultView="index",this.transtion=u,this.lastView,this.curView},initialize:function($super,i){$super(),this.setOption(i),this.initDom()},setOption:function(i){e.isNUL(i.app)||(this.app=i.app),e.isNUL(i.name)||(this.name=i.name),e.isNUL(i.viewpath)||(this.viewpath=i.viewpath),e.isNUL(i.framebox)||(this.framebox=i.framebox),e.isNUL(i.defaultView)||(this.defaultView=i.defaultView),e.isNUL(i.transtion)||(this.transtion=i.transtion)},getRoot:function(){return this.root},initDom:function(){this.framebox.append(this.root)},hashChange:function(i){i.view||(i=h.parse(this.defaultView)),this.hashdata=i,this.header.setForward(this.hashdata.forward),this.toView(i.view,i)},toView:function(i,t){var e=this;this.getView(i,t).then(function(i,t,s){e.lastView=e.curView||s,e.curView=s,s.onLoad()})},turning:function(){this.curView===this.lastView?(this.curView.getRoot().show(),this.curView.onShow()):this.transferView(this.lastView,this.curView,function(){this.lastView.onHide(),this.curView.onShow()})},getView:function(i,t){var e=this.views.get(i),s=new n;return e?(e.setHashData(t),s.resolve(e)):this.loadView(i,function(e){if(!e)throw new Error("not found `"+i+".js`");var a=new e(i,t,this,this.app);this.viewport.append(a.getRoot()),a.emit("addframe"),this.views.push(i,a),a.onCreate(),s.resolve(a)}),s},loadView:function(i,t){var e=this.buildFullPath(i),s=this;seajs.use([e],function(i){t.call(s,i)})},getCurrentView:function(){return this.curView||this.lastView},buildFullPath:function(i){return(this.viewpath+"/"+i).replace(/\/+/g,"/")+".js"},transferView:function(i,t,e){this.hashdata.forward?this.transtion.into(i.getRoot(),t.getRoot(),function(){e.call(this)},this):this.transtion.out(i.getRoot(),t.getRoot(),function(){e.call(this)},this)},forward:function(i){var t=h.parse(i);t.frame&&t.frame!==this.name||this.hashChange(t)},back:function(){history.back()},toHead:function(i,t){this.header.to(i,t)},showToast:function(i,t,e){V().show({content:i,timeout:t,callback:e})},hideToast:function(){V().hide()},showAlert:function(i,t,e){g().show({title:e||"标题",content:i||"",buttons:t})},hideAlert:function(){g().hide()},showLoading:function(i){b().show({maskOpacity:i})},hideLoading:function(){b().hide()},showHeader:function(){this.header.show()},hideHeader:function(){this.header.hide()}});return x});